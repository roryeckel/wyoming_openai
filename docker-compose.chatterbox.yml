services:
  wyoming_openai:
    image: ghcr.io/roryeckel/wyoming_openai:latest
    container_name: wyoming_openai
    ports:
      - "10300:10300"
    restart: unless-stopped
    environment:
      WYOMING_URI: tcp://0.0.0.0:10300
      WYOMING_LOG_LEVEL: INFO
      WYOMING_LANGUAGES: en
      TTS_OPENAI_URL: http://chatterbox-tts:4123/v1
      TTS_MODELS: "tts-1"
      TTS_BACKEND: "OPENAI"
      TTS_VOICES: "default"
      TTS_SPEED: "1.0"
    depends_on:
      chatterbox-tts:
        condition: service_healthy

  chatterbox-tts:
    image: travisvn/chatterbox-tts-api:latest
    container_name: chatterbox-tts
    restart: unless-stopped
    ports:
      - "4123:4123"
    environment:
      # API Configuration
      - PORT=4123
      - HOST=0.0.0.0

      # TTS Model Settings
      - EXAGGERATION=0.5
      - CFG_WEIGHT=0.5
      - TEMPERATURE=0.8

      # Text Processing
      - MAX_CHUNK_LENGTH=280
      - MAX_TOTAL_LENGTH=3000

      # Voice and Model Settings
      - VOICE_SAMPLE_PATH=/app/voice-sample.mp3
      - DEVICE=auto
      - MODEL_CACHE_DIR=/cache
      - VOICE_LIBRARY_DIR=/voices

      # Memory Settings
      - MEMORY_CLEANUP_INTERVAL=5
      - CUDA_CACHE_CLEAR_INTERVAL=3
      - ENABLE_MEMORY_MONITORING=true
    volumes:
      # Mount model cache for persistence
      - chatterbox-models:/cache

      # Mount voice library for persistence
      - chatterbox-voices:/voices
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4123/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s

volumes:
  chatterbox-models:
  chatterbox-voices: